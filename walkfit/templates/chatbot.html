<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WalkFit</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      height:100dvh;
      background:#0d0d17;
      color:#e0e0ff;
      font-family:system-ui,-apple-system,sans-serif;
      display:grid;
      grid-template-rows:auto 1fr auto;
    }

    header{
      padding:1.1rem 1rem;
      background:linear-gradient(180deg,#0d7c82,#245978);
      text-align:center;
      border-bottom:1px solid #223644;
      position:relative;
    }
    header img{
      width:64px;
      height:64px;
      border-radius:50%;
      object-fit:cover;
      box-shadow:0 4px 12px #ff950022;
    }
    header h1{
      font-size:1.7rem;
      font-weight:600;
      color:#99743f;
      margin-top:0.4rem;
    }
    #home-btn {
      position:absolute;
      left:1rem;
      top:50%;
      transform:translateY(-50%);
      background:#ff950022;
      color:#ff9500;
      border:none;
      border-radius:50%;
      width:40px;
      height:40px;
      font-size:1.4rem;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    #chat{
      overflow-y:auto;
      padding:1rem;
      display:flex;
      flex-direction:column;
      gap:1rem;
    }

    .msg{
      padding:0.9rem 1.3rem;
      border-radius:1.4rem;
      max-width:80%;
      line-height:1.4;
      word-wrap:break-word;
    }
    .user{
      background:#ff9500;
      color:#0f0f1a;
      align-self:flex-end;
      border-bottom-right-radius:0.5rem;
    }
    .bot{
      background:#1e1e38;
      align-self:flex-start;
      border-bottom-left-radius:0.5rem;
    }

    #input-area{
      padding:1rem;
      background:#111122;
      border-top:1px solid #222244;
      position:sticky;
      bottom:0;
    }
    .input-wrap{
      display:flex;
      gap:0.7rem;
      background:#1a1a2e;
      border-radius:999px;
      padding:0.5rem 0.6rem;
      box-shadow:0 4px 16px #0006;
    }
    #message{
      flex:1;
      background:transparent;
      border:none;
      color:white;
      font-size:1rem;
      padding:0 0.8rem;
      outline:none;
    }
    #message::placeholder{color:#777799}
    #send{
      background:#ff9500;
      color:#0f0f1a;
      border:none;
      font-weight:600;
      padding:0.6rem 1.3rem;
      border-radius:999px;
      cursor:pointer;
    }

    @media (min-width:640px) {
      body{max-width:560px;margin:0 auto;border-left:1px solid #222;border-right:1px solid #222}
      header{padding:1.4rem 1.2rem}
      #chat{padding:1.4rem}
    }
  </style>
</head>
<body>

  <header>
    <button id="home-btn">üè†</button>
    <img src="{{ icon_url }}" alt="WalkFit">
    <h1>WalkFit</h1>
  </header>

  <div id="chat"></div>

  <div id="input-area">
    <div class="input-wrap">
      <input id="message" placeholder="Ask anything about walking & fitness‚Ä¶" autocomplete="off"/>
      <button id="send">Send</button>
    </div>
  </div>

  <script>
    const chat = document.getElementById('chat');
    const input = document.getElementById('message');
    const sendBtn = document.getElementById('send');
    const homeBtn = document.getElementById('home-btn');

    homeBtn.onclick = () => {
      window.location.href = '/home/'; // or wherever your home is
    };

    function addMsg(text, cls) {
      const div = document.createElement('div');
      div.className = `msg ${cls}`;
      div.textContent = text;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    async function send() {
      const text = input.value.trim();
      if (!text) return;
      addMsg(text, 'user');
      input.value = '';

      try {
        const res = await fetch('', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({message: text})
        });
        const data = await res.json();
        addMsg(data.reply || data.error || 'No response', 'bot');
      } catch {
        addMsg("Error connecting", 'bot');
      }
    }

    sendBtn.onclick = send;
    input.onkeypress = e => { if (e.key === 'Enter') send(); };
  </script>

</body>
</html>